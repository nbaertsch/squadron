# .squadron/config.yaml — Squadron project configuration
# See docs/project-plan/research/config-schema.md for full reference.

# ─────────────────────────────────────────────
# Project Identity
# ─────────────────────────────────────────────
project:
  name: "squadron"
  owner: "nbaertsch"
  repo: "squadron"
  default_branch: squadron-dev
  bot_username: "squadron-dev[bot]"

# ─────────────────────────────────────────────
# Label Taxonomy
# ─────────────────────────────────────────────
labels:
  types:
    - feature
    - bug
    - security
    - documentation
    - infrastructure
  priorities:
    - critical
    - high
    - medium
    - low
  states:
    - needs-triage
    - in-progress
    - blocked
    - needs-human
    - needs-clarification

# ─────────────────────────────────────────────
# Branch Naming Conventions
# ─────────────────────────────────────────────
branch_naming:
  feature: "feat/issue-{issue_number}"
  bugfix: "fix/issue-{issue_number}"
  security: "security/issue-{issue_number}"
  docs: "docs/issue-{issue_number}"
  infra: "infra/issue-{issue_number}"
  hotfix: "hotfix/issue-{issue_number}"
  chore: "chore/{description}"

# ─────────────────────────────────────────────
# Human Groups
# ─────────────────────────────────────────────
human_groups:
  maintainers: ["@noahbaertsch"]

# ─────────────────────────────────────────────
# Agent Roles
# ─────────────────────────────────────────────
agent_roles:
  pm:
    agent_definition: agents/pm.md
    singleton: true
    stateless: true
    triggers:
      - event: "issues.opened"
      - event: "issues.reopened"
      - event: "issue_comment.created"
    subagents: [feat-dev, bug-fix, pr-review, security-review, docs-dev, infra-dev]

  feat-dev:
    agent_definition: agents/feat-dev.md
    triggers:
      - event: "issues.labeled"
        label: feature
    subagents: [code-search, test-writer]

  bug-fix:
    agent_definition: agents/bug-fix.md
    triggers:
      - event: "issues.labeled"
        label: bug

  pr-review:
    agent_definition: agents/pr-review.md

  security-review:
    agent_definition: agents/security-review.md
    triggers:
      - event: "issues.labeled"
        label: security

  docs-dev:
    agent_definition: agents/docs-dev.md
    triggers:
      - event: "issues.labeled"
        label: documentation

  infra-dev:
    agent_definition: agents/infra-dev.md
    triggers:
      - event: "issues.labeled"
        label: infrastructure

  test-coverage:
    agent_definition: agents/test-coverage.md

# ─────────────────────────────────────────────
# Circuit Breakers
# ─────────────────────────────────────────────
circuit_breakers:
  defaults:
    max_iterations: 5
    max_tool_calls: 200
    max_turns: 50
    max_active_duration: 7200    # 2 hours
    max_sleep_duration: 86400    # 24 hours
    warning_threshold: 0.80

  roles:
    pm:
      max_tool_calls: 50
      max_turns: 10
      max_active_duration: 600   # 10 minutes
    pr-review:
      max_tool_calls: 100
      max_turns: 20
      max_active_duration: 1800  # 30 minutes
    security-review:
      max_tool_calls: 100
      max_turns: 20
      max_active_duration: 1800  # 30 minutes
    test-coverage:
      max_tool_calls: 100
      max_turns: 20
      max_active_duration: 1800  # 30 minutes

# ─────────────────────────────────────────────
# Runtime / LLM Configuration
# ─────────────────────────────────────────────
runtime:
  default_model: "claude-sonnet-4"
  # NOTE: reasoning_effort is NOT supported by claude-sonnet-4 via the
  # Copilot SDK.  Omit per-role overrides until model support is added.

  models:
    pm:
      model: "claude-sonnet-4"
    feat-dev:
      model: "claude-sonnet-4"
    bug-fix:
      model: "claude-sonnet-4"
    pr-review:
      model: "claude-sonnet-4"
    security-review:
      model: "claude-sonnet-4"
    test-coverage:
      model: "claude-sonnet-4"

  # Provider: "copilot" uses the SDK's built-in Copilot auth (default).
  # For BYOK (bring-your-own-key), set type to "anthropic" or "openai"
  # and supply api_key_env pointing to an env var with the key.
  provider:
    type: "copilot"

  reconciliation_interval: 300   # 5 minutes

# ─────────────────────────────────────────────
# Escalation / Notifications
# ─────────────────────────────────────────────
escalation:
  default_notify: maintainers
  escalation_labels:
    - needs-human
    - escalation
  max_issue_depth: 3

# ─────────────────────────────────────────────
# Approval Flows
# ─────────────────────────────────────────────
approval_flows:
  enabled: true
  default_reviewers:
    - pr-review
  rules:
    - name: security-sensitive
      match_labels: [security]
      match_paths:
        - "src/**/auth/**"
        - "src/**/crypto/**"
        - "**/security/**"
      reviewers: [security-review]
      required_approvals: 1
    - name: infrastructure
      match_labels: [infrastructure]
      match_paths:
        - ".squadron/**"
        - "pyproject.toml"
        - "Dockerfile"
        - ".github/**"
      reviewers: [pr-review]
      required_approvals: 1
