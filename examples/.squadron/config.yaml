# .squadron/config.yaml — Squadron project configuration
#
# Copy this entire .squadron/ directory into your repository root,
# then edit the two REQUIRED fields below. Everything else has
# sensible defaults that produce a working PM + feat-dev + pr-review system.
#
# Full schema reference: see src/squadron/config.py

# ── REQUIRED ─────────────────────────────────────────────────────────────────

project:
  name: "my-project"          # REQUIRED — your project name
  owner: "my-org"             # GitHub org or username
  repo: "my-repo"             # GitHub repo name
  default_branch: main

human_groups:
  maintainers: ["your-github-username"]   # REQUIRED — at least one human for escalations

# ── OPTIONAL (defaults shown) ────────────────────────────────────────────────
# Uncomment and modify sections as needed.

# labels:
#   types: [feature, bug, security, docs]
#   priorities: [critical, high, medium, low]
#   states: [needs-triage, in-progress, blocked, needs-human, needs-clarification]

# branch_naming:
#   feature: "feat/issue-{issue_number}"
#   bugfix: "fix/issue-{issue_number}"
#   security: "security/issue-{issue_number}"

agent_roles:
  pm:
    agent_definition: agents/pm.md
    singleton: true
    lifecycle: ephemeral
    triggers:
      - event: "issues.opened"
      # Comments are routed via @pm / /pm mentions (Layer 2 routing).
      # No issue_comment.created trigger needed — mention routing handles it.
  feat-dev:
    agent_definition: agents/feat-dev.md
    triggers:
      - event: "issues.labeled"
        label: feature
      # Sleep dev agent when it opens a PR (wait for review)
      - event: "pull_request.opened"
        action: sleep
      # Wake dev agent when reviewer requests changes
      - event: "pull_request_review.submitted"
        condition: {review_state: "changes_requested"}
        action: wake
      # Wake dev agent when reviewer leaves comments/questions (needs response)
      - event: "pull_request_review.submitted"
        condition: {review_state: "commented"}
        action: wake
      # Wake dev agent when PR is closed without merge (needs rework)
      - event: "pull_request.closed"
        condition: {merged: false}
        action: wake
      # Complete dev agent when PR is merged
      - event: "pull_request.closed"
        condition: {merged: true}
        action: complete
  bug-fix:
    agent_definition: agents/bug-fix.md
    triggers:
      - event: "issues.labeled"
        label: bug
      - event: "pull_request.opened"
        action: sleep
      - event: "pull_request_review.submitted"
        condition: {review_state: "changes_requested"}
        action: wake
      - event: "pull_request_review.submitted"
        condition: {review_state: "commented"}
        action: wake
      - event: "pull_request.closed"
        condition: {merged: false}
        action: wake
      - event: "pull_request.closed"
        condition: {merged: true}
        action: complete
  pr-review:
    agent_definition: agents/pr-review.md
    triggers:
      # Spawn via approval flow when PR is opened
      - event: "pull_request.opened"
        condition: {approval_flow: true}
      # Wake reviewer when PR is updated (new commits pushed)
      - event: "pull_request.synchronize"
        action: wake
      # Complete reviewer when PR is closed/merged
      - event: "pull_request.closed"
        action: complete
  security-review:
    agent_definition: agents/security-review.md
    triggers:
      - event: "issues.labeled"
        label: security
      - event: "pull_request.opened"
        condition: {approval_flow: true}
      - event: "pull_request.synchronize"
        action: wake
      - event: "pull_request.closed"
        action: complete

# circuit_breakers:
#   defaults:
#     max_iterations: 5
#     max_tool_calls: 200
#     max_turns: 50
#     max_active_duration: 7200      # 2 hours
#     max_sleep_duration: 86400      # 24 hours

# runtime:
#   default_model: claude-sonnet-4.6
#   max_concurrent_agents: 10
#   provider:
#     type: copilot                  # or "anthropic" for BYOK
#     api_key_env: ANTHROPIC_API_KEY

approval_flows:
  enabled: true
  default_reviewers: [pr-review]
  rules:
    - name: security-review
      match_labels: [security]
      reviewers: [security-review]

# Sandbox — namespace-based isolation for agent subprocesses.
# Requires Linux kernel >= 3.8.  Strongly recommended for any deployment
# where agents have bash tool access.
sandbox:
  enabled: true
